<% layout('layout') -%>
<% script('/scripts/main.js') -%>
<% script('profileEdit.js') -%>
<% stylesheet('/video-js/video-js.css') -%>
<% script('/video-js/video.js') -%>
<!DOCTYPE html>
<html>
  <head>
    <title>stamp.fm</title>
    <link rel="icon" type="image/png" href="/img_samp.fm_logo copy.jpg"/>
    <link rel="stylesheet" type="text/css" href="/gridiculous.css">
    <link rel="stylesheet" type="text/css" href="/profile.css">
    <link rel="stylesheet" type="text/css" href="/dropzone.css">
    <meta http-equiv="content-type" content="text/html;charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  </head>
  
  <body>
    <div id="wrapper">


<div id="profileContent" class="grid wfull">

  <div class="row">
    <div class="c3" id="songList" style="position: center">
          <center><span id="songListLabel">Songs</span></center>
          <div id="songContent">
           <div id="song">
             <div style=" overflow:auto;">
               <table cellspacing="0" cellpadding="1" cellpadding class = "songnames">
      <% songs.forEach(function(song){ %>
        <tr id="song_name" style="color:#000;">
          <td><div data-tag ="<%=song._id%>" class = "vidPlay" style="width:200px;"><%= song.name %></div></td>
          <td><img data-name = "<%=song.name%>" data-tag ="<%=song._id%>" class = "addPlay" src="http://cdn2.iconfinder.com/data/icons/picons-essentials/71/plus-512.png" style="height:20px;width:25px;float:right;"></td>
          <td><img data-tag = "<%=song._id%>" class="deletebutton" src="http://cdn2.iconfinder.com/data/icons/picons-essentials/71/plus-512.png" style="height:20px;width:25px;float:right;-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);"></td>
        </tr>
      <% }); %>
          </table>  
        </div>
            </div> 
          </div>
        </div>


        <center>
        <div id="name" class="c4">

        <spanName id="displayName" style="color:black"><%=name%></spanName>
        <div id="location">
        <spanLocation id="spanLocation">
        <span id="displayLocation"><%=location%></span>
        </spanLocation>
        </div>
      <div id="profilePic"><img id="picture" src="<%=imgid%>">
        <br>
      </div>

      <div id="bio" >
    <spanBio id="displayBio"><%=bio%></spanBio>
      </div>

        <a href="#" id="fb"><img src="facebookIcon.png" id="fbIcon"></a>
        <a href="#" id="twit"><img src="twitter.png" id="twitIcon"></a> 
        <br>

        <div id="video">
          <div class="c12 end" id="videoPlayer" style="border:none">
           <video id="vidYo" class="video-js vjs-default-skin" controls data-setup='{"techOrder": "html5", "flash", "other supported tech"]}'>
                <source src="<%=songId%>" type="video/mp4" id = "source">
            </video>
          </div>   
         </div> 
   
</center> 


    <div class="c3" id="playlist" style="float:right">
          <center><span id="playlistLabel">Favorites</span></center>
          <div id="playlistContent">
              <div id="song" style=" overflow:auto;">
        <table cellspacing="0" cellpadding="0" >
               <table cellspacing="0" cellpadding="1" style="color:#000">
      <% playlist.forEach(function(play){ %>
        <tr id="playlist_name">
          <td><div style="width:250px;" data-tag ="<%=play._id%>" class = "vidPlay"><%= play.name %></div></td>
          <td><img data-tag = "<%=play._id%>" class="playdelete" src="http://cdn2.iconfinder.com/data/icons/picons-essentials/71/plus-512.png" style="height:40px;width:50px;float:right;-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);"></td>
        </tr>
        <% }); %>
          </table> 
        </table>
            </div> 
          </div>
        </div> 

</div>
</div>

<!-- Modal Window(s) -->

<div id="notReal" class="modalDialog_temp">
  <div>
    <a href="#close" title="Close" class="close">X</a>
    <center>
    <h3 style="color:white">This stage of the competition has not begun yet.<br><br>
    See you July 25th!</h3>
    <p style="color:white">Stay up to date by liking us on Facebook or following us on Twitter!</p>
    <ul>
      <li> <div class="fb-like" data-href="https://www.facebook.com/Stamp.fm?fref=ts" data-send="false" data-layout="button_count" data-width="450" data-show-faces="false" data-font="arial"></div></li>
      <li>  <div>
            <a href="https://twitter.com/stampfm" class="twitter-follow-button" data-show-count="false" data-lang="en"></a>
            <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script></div></li>
    </ul>          
    </center>
  </div>
</div>

<!-- End Modal Window(s) -->

<!-- Modal Window(s) -->

<div id="accountInfo" class="modalDialog_account">
  <div>
    <a href="#close" title="Close" class="close">X</a>
    <center>
    <h3 style="color:white">Edit Your Account Info</h3>
    <form id="editAccount" method = "POST" action = "/updateAccount">
      <br>
      <input type="email" name = "email" placeholder="Change your Email Address" id="editEmail"><br><br><br>
      <input type="password" name = "pass" placeholder="Change your Password" id="password"><br><br>
      <input type="password" placeholder="Confirm New Password" id="passwordConfirm"><br><br><br>
      <input type="submit" value="Confirm" id="confirm">
    </form>         
    </center>
  </div>
</div>

<!-- End Modal Window(s) -->

<!-- FB Like Script-->
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

<!-- End FB Like Script -->
<script>
  $(document).ready(function() {
    $("#profileUpload").submit(function(e){
      return false;
    });
    $('#songSubmit').click(function(event){ 
     var name = $('#songName').val();
     $.ajax({ 
           url: '/profileUpload',
           type: 'POST',
           cache: false, 
           data: {name : name},
           success: function(data){
            if(data.msg == "saved"){
              alert("Your song has been saved!");
            }
            if (typeof data.redirect == 'string'){
              window.location = data.redirect;
            }
           }
        })
     });
    $('.vidPlay').click(function(event){
      var tag = $(this).attr('data-tag');
      $.ajax({
        url: '/vidPlay',
        type: 'POST',
        cache: false,
        data: {video : tag},
        success: function(data){
          $('#vidYo').find("#source").attr("src", data.video);
          $('#vidYo').load();
          $('#vidYo').get(0).play();
        }
      });
    });
    $('.addPlay').click(function(event){
      var tag = $(this).attr('data-tag');
      var name = $(this).attr('data-name');
      console.log(tag);
      console.log(name);
      $.ajax({
        url: '/addPlay',
        type: 'POST',
        cache: false,
        data: {sid: tag, name: name},
        success: function(data){
          alert(data.name + "was added to your Playlist");
        }
      })
    })
    $('.deletebutton').click(function(event){
      var tag = $(this).attr('data-tag');
      $.ajax({
        url: '/deleteSong',
        type: 'POST',
        cache: false,
        data: {id: tag},
        success: function(data){
          if(data.msg == "yes"){
            alert("You have successfully deleted this song.");
          }
          else if(data.msg == "no"){
            alert("You cannot delete a video uploaded to the tournament.");
          }
        }
      })
    })
    $('.playdelete').click(function(event){
      var tag = $(this).attr('data-tag');
      $.ajax({
        url: '/playDelete',
        type: 'POST',
        cache: false,
        data: {id: tag},
        success: function(data){
          if(data.msg){
            alert("You have successfully deleted this song from your playlist.");
          }
        }
      });
    });
    $('#chName').submit(function(event){
      return false;
    })
    $('#submitNameButton').click(function(event){
      var name = $('#displayNameEdit').val();
      $.ajax({
        url: '/changeName',
        type: 'POST',
        cache: false,
        data: {editName: name}
      })
    })
    $('#chBio').submit(function(event){
      return false;
    })
    $('#submitBioButton').click(function(event){
      var bio = $('#displayBioEdit').val();
      $.ajax({
        url: '/changeBio',
        type: 'POST',
        cache: false,
        data: {editBio: bio}
      })
    })
    $('#chLoc').submit(function(event){
      return false;
    })
    $('#submitLocationButton').click(function(event){
      var loc = $('#displayLocationEdit').val();
      $.ajax({
        url: '/changeLocation',
        type: 'POST',
        cache: false,
        data: {editLocation: loc}
      })
    })
  });
</script>
</body>

